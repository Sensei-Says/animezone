const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GetBody-B8HXsZU1.js","assets/vendor-qYA6LsDu.js"])))=>i.map(i=>d[i]);
var he=Object.defineProperty;var ve=(r,e,t)=>e in r?he(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var R=(r,e,t)=>ve(r,typeof e!="symbol"?e+"":e,t);import{d as ce,r as b,c as T,a as U,b as v,e as n,f as ue,w as J,g as me,v as _e,h as fe,o as d,u as q,i as F,F as L,j as O,t as y,k as de,l as D,n as ee,s as ge,m as ye,p as te,q as $e,x as Ae,y as be,z as Pe,A as Re,B as we,C as Se}from"./vendor-qYA6LsDu.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const c of u.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerPolicy&&(u.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?u.credentials="include":a.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function s(a){if(a.ep)return;a.ep=!0;const u=t(a);fetch(a.href,u)}})();function se(r,e=2){const t=r.split(".");if(e<=0)throw new Error("levelsToKeep должно быть больше 0");return t.length>e?t.slice(-e).join("."):r}class x{constructor(e,t,s,a={}){this.type=e,this.quality=t,this.url=s,this.headers=a}toObject(){return{type:this.type,quality:this.quality,url:this.url,headers:this.headers}}toString(){const e=new URL(this.url);return`[${this.quality}] ${e.hostname}...${this.type}`}equals(e){if(!(e instanceof x))throw new TypeError(`Требуется объект Video, а не ${typeof e}`);const t=new URL(this.url),s=new URL(e.url),a=se(t.hostname),u=se(s.hostname);return this.type===e.type&&this.quality===e.quality&&a===u}}class B{static isValidUrl(e){return typeof this.URL_RULE=="string"?new RegExp(this.URL_RULE).test(e):this.URL_RULE.test(e)}}R(B,"URL_RULE",/^/),R(B,"DEFAULT_HTTP_CONFIG",{});const ne=/^https:\/\/kodik\.info/,E=class E extends B{constructor(){super()}async fetchGet(e,t={}){const s={method:"GET",...t};delete s.headers;const a=e.replace("https://kodik.info","/api/kodik");return console.log("Using proxy URL:",a,"instead of:",e),await fetch(a,s)}async fetchPost(e,t,s){const a=new URLSearchParams(Object.entries(t));s["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",body:a,headers:s},c=e.replace("https://kodik.info","/api/kodik");return console.log("Using proxy URL for POST:",c,"instead of:",e),fetch(c,u)}decryptUrl(e){let t="";for(const s of e)s>="A"&&s<="Z"?t+=String.fromCharCode((s.charCodeAt(0)-65+18)%26+65):s>="a"&&s<="z"?t+=String.fromCharCode((s.charCodeAt(0)-97+18)%26+97):t+=s;return t}decode(e){if(e.endsWith(".m3u8"))return e.startsWith("https")?e:`https:${e}`;let t=this.decryptUrl(e);const s=atob(t);return s.startsWith("https")?s:`https:${s}`}getNetloc(e){return new URL(e).hostname}createUrlApi(e,t="ftor"){return`https://${e}${t}`}createApiHeaders(e,t){return{origin:`https://${t}`,referer:e,accept:"application/json, text/javascript, */*; q=0.01"}}isNotFoundedVideo(e){return/<div class="message">Видео не найдено<\/div>/.test(e)}isUnhandledErrorResponse(e,t){return e.status===500&&t.includes("An unhandled lowlevel error occurred")}updateApiPath(e){const t=/\$\.ajax\([^>]+,url:\s*atob\([\"\']([^"\']+)[\"\']\)/.exec(e);t&&t[1]&&(E.CACHED_API_PATH=atob(t[1]))}extractApiPayload(e){const t=/var\s*urlParams\s*=\s*['\"](\{.*\})['"]/i.exec(e);let s={};if(t&&t[1])try{s=JSON.parse(t[1])}catch(h){console.error("Error parsing urlParams:",h)}const a=/var\s*domain\s+=\s+[\'\"](.*?)[\'\"];/.exec(e),u=/var\s*d_sign\s+=\s+[\'\"](.*?)[\'\"];/.exec(e),c=/var\s*pd\s+=\s+[\'\"](.*?)[\'\"];/.exec(e),p=/var\s*pd_sign\s+=\s+[\'\"](.*?)[\'\"];/.exec(e),_=/var\s*ref\s+=\s+[\'\"](.*?)[\'\"];/.exec(e),o=/var\s*ref_sign\s+=\s+[\'\"](.*?)[\'\"];/.exec(e),m=/videoInfo\.type\s*=\s*[\'\"](.*?)[\'\"];/.exec(e),i=/videoInfo\.hash\s*=\s*[\'\"](.*?)[\'\"];/.exec(e),l=/videoInfo\.id\s*=\s*[\'\"](.*?)[\'\"];/.exec(e),g={d:(a==null?void 0:a[1])||"",d_sign:(u==null?void 0:u[1])||"",pd:(c==null?void 0:c[1])||"",pd_sign:(p==null?void 0:p[1])||"",ref:(_==null?void 0:_[1])||"",ref_sign:(o==null?void 0:o[1])||"",type:(m==null?void 0:m[1])||"",hash:(i==null?void 0:i[1])||"",id:(l==null?void 0:l[1])||"",...E.API_CONSTS_PAYLOAD},A=/<script\s*type="text\/javascript"\s*src="(\/assets\/js\/app\..*?)">/i.exec(e),w=(A==null?void 0:A[1])||"";return{urlParams:s,apiPayload:g,playerJsPath:w}}extract(e){return e[720]?[new x("m3u8",360,this.decode(e[360][0].src)),new x("m3u8",480,this.decode(e[480][0].src)),new x("m3u8",720,this.decode(e[720][0].src))]:e[480]?[new x("m3u8",360,this.decode(e[360][0].src)),new x("m3u8",480,this.decode(e[480][0].src))]:[new x("m3u8",360,this.decode(e[360][0].src))]}async parse(e){if(!ne.test(e))throw new TypeError(`Некорректный URL для плеера ${this.constructor.name}`);try{const t=await this.fetchGet(e),s=await t.text();if(this.isUnhandledErrorResponse(t,s))return console.warn('Error! Kodik returns "An unhandled lowlevel error occurred"'),[];if(this.isNotFoundedVideo(s))return console.warn("Error! Video not found"),[];const{apiPayload:a,playerJsPath:u}=this.extractApiPayload(s),c=this.getNetloc(e);if(!E.CACHED_API_PATH){const i=`https://${c}${u}`,g=await(await this.fetchGet(i)).text();this.updateApiPath(g)}const p=this.createUrlApi(c,E.CACHED_API_PATH||""),_=this.createApiHeaders(e,c);let o=await this.fetchPost(p,a,_);if(!o.ok){const i=`https://${c}${u}`,g=await(await this.fetchGet(i)).text();this.updateApiPath(g);const A=this.createUrlApi(c,E.CACHED_API_PATH||"");o=await this.fetchPost(A,a,_)}const m=await o.json();return this.extract(m.links)}catch(t){return console.error("Error parsing Kodik:",t),[]}}};R(E,"URL_RULE",ne),R(E,"CACHED_API_PATH",null),R(E,"DEFAULT_HTTP_CONFIG",{http2:!0}),R(E,"API_CONSTS_PAYLOAD",{bad_user:!1,info:{},cdn_is_working:!0});let K=E;const ke=[K];function Ee(r){for(const e of ke)if(e.isValidUrl(r))return new e}class M{constructor(){R(this,"BASE_URL","https://api.yani.tv/")}async apiRequest(e,t={}){const s=new URL(this.BASE_URL+e);return Object.keys(t).length&&Object.entries(t).forEach(([u,c])=>{s.searchParams.append(u,String(c))}),await(await fetch(s.toString(),{method:"GET",headers:{Lang:"ru"}})).json()}async getAnime(e,t=!0,s={}){const a={need_videos:t,...s};return(await this.apiRequest(`anime/${e}`,a)).response}async searchTitles(e,t=20,s=0,a={}){const u={q:e,limit:t,offset:s,...a};return(await this.apiRequest("search",u)).response}async getUpdates(e={}){return(await this.apiRequest("anime/schedule",e)).response}}class Ue{constructor(e){R(this,"searchResult");this.searchResult=e}async getAnime(){return new Z(await new M().getAnime(this.searchResult.anime_id))}}class Ce{constructor(e){R(this,"ongoingResult");this.ongoingResult=e}async getAnime(){return new Z(await new M().getAnime(this.ongoingResult.anime_id))}}class Z{constructor(e){R(this,"animeResult");R(this,"players");this.animeResult=e,this.players=this.getPlayers()}getPlayers(){const e={};this.animeResult.videos.forEach(s=>{if(s.iframe_url.startsWith("//")&&(s.iframe_url="https:"+s.iframe_url),!(typeof Ee(s.iframe_url)>"u")){e[s.data.player]||(e[s.data.player]={name:s.data.player,dubbers:[]});var a=e[s.data.player].dubbers.find(u=>u.dubbing===s.data.dubbing);a||(a={dubbing:s.data.dubbing,player:s.data.player,episodes:[]},e[s.data.player].dubbers.push(a)),e[s.data.player].dubbers.forEach(u=>{u.dubbing===s.data.dubbing&&u.episodes.push({video:new x("auto","auto",s.iframe_url,{}),number:s.data.episode||s.number,iframe_url:s.iframe_url})})}});const t=Object.values(e);return t.forEach(s=>{s.dubbers.forEach(a=>{a.episodes.sort((u,c)=>Number(u.number)-Number(c.number))})}),t}}class j{constructor(){R(this,"api");this.api=new M}async Search(e){return(await this.api.searchTitles(e)).map(t=>new Ue(t))}async getOngoings(){return(await this.api.getUpdates()).filter(t=>t.episodes.aired>0).map(t=>new Ce(t))}async getAnime(e){return new Z(await this.api.getAnime(e))}}var C=(r=>(r[r.Search=0]="Search",r[r.Anime=1]="Anime",r[r.Player=2]="Player",r[r.History=3]="History",r[r.Favourites=4]="Favourites",r))(C||{});const N=ce("app",()=>{const r=b([]),e=T(()=>r.value.length>0?r.value[r.value.length-1]:void 0);return{opened:r,currentBody:e,openAnimePage:o=>{(r.value.length<1||r.value[r.value.length-1].type!==1||r.value[r.value.length-1].value!==o)&&r.value.push({type:1,value:o})},closeLast:()=>{r.value.length>0&&r.value.pop()},closeAll:()=>{r.value=[]},playAnime:o=>{r.value.push({type:2,value:o})},searchAnime:o=>{(r.value.length<1||r.value[r.value.length-1].type!==0||r.value[r.value.length-1].value!==o)&&r.value.push({type:0,value:o})},openHistory:()=>{(r.value.length<1||r.value[r.value.length-1].type!==3)&&r.value.push({type:3})},openFavourites:()=>{(r.value.length<1||r.value[r.value.length-1].type!==4)&&r.value.push({type:4})}}}),xe={class:"header"},Le={class:"nav"},Oe={class:"search"},Ie=U({__name:"AppHeader",setup(r){const e=N(),{openHistory:t,openFavourites:s,searchAnime:a,closeAll:u}=e,c=b(""),p=()=>{c.value.trim()&&a(c.value.trim())},_=()=>{u()},o=m=>{if(e.currentBody)u();else{const i=document.getElementById(m);i&&i.scrollIntoView({behavior:"smooth"})}};return(m,i)=>(d(),v("header",xe,[n("div",{class:"logo",onClick:_},[...i[4]||(i[4]=[ue("Anime",-1),n("span",null,"Zone",-1)])]),n("nav",Le,[n("a",{href:"#",onClick:i[0]||(i[0]=J(l=>o("ongoing"),["prevent"]))},"Онгоинги"),n("a",{href:"#",onClick:i[1]||(i[1]=J((...l)=>q(t)&&q(t)(...l),["prevent"]))},"История"),n("a",{href:"#",onClick:i[2]||(i[2]=J((...l)=>q(s)&&q(s)(...l),["prevent"]))},"Избранное")]),n("div",Oe,[me(n("input",{type:"text",placeholder:"Поиск аниме...","onUpdate:modelValue":i[3]||(i[3]=l=>c.value=l),onKeyup:fe(p,["enter"])},null,544),[[_e,c.value]])])]))}}),pe=(r,e)=>{const t=r.__vccOpts||r;for(const[s,a]of e)t[s]=a;return t},Ne=pe(Ie,[["__scopeId","data-v-2a619eeb"]]),Fe={class:"home-page"},He={class:"main"},Te={id:"ongoing",class:"section"},De={key:0,class:"anime-grid"},qe=["onClick"],je=["src","alt"],Je={class:"card-info"},Ve={key:1,class:"loading-message"},Ge=U({__name:"HomePage",setup(r){const e=N(),{openAnimePage:t}=e,s=b([]),a=p=>{t(p)},u=p=>{var _,o;if((o=(_=p.ongoingResult)==null?void 0:_.poster)!=null&&o.huge){const m=p.ongoingResult.poster.huge;return m.startsWith("http")?m:`https:${m}`}return"https://via.placeholder.com/300x400/333/fff?text=No+Image"},c=async()=>{var p;try{const _=new j;console.log("Загружаем онгоинги...");const o=await _.getOngoings();console.log("Онгоинги загружены:",o.length),o.length>0&&console.log("Первый онгоинг:",((p=o[0].ongoingResult)==null?void 0:p.title)||"Без названия");const m=[],i=[];o.forEach((l,g)=>{l.ongoingResult&&l.ongoingResult.title?m.push(l):(i.push({index:g,ongoing:l}),console.log(`Невалидный онгоинг ${g}:`,l))}),console.log(`Всего онгоингов: ${o.length}`),console.log(`Валидных онгоингов: ${m.length}`),console.log(`Невалидных онгоингов: ${i.length}`),s.value=m}catch(_){console.error("Ошибка при загрузке данных:",_)}};return F(()=>{c()}),(p,_)=>(d(),v("div",Fe,[n("main",He,[n("section",Te,[_[1]||(_[1]=n("h2",{class:"section-title"},"Онгоинги",-1)),s.value.length>0?(d(),v("div",De,[(d(!0),v(L,null,O(s.value,(o,m)=>{var i,l,g,A;return d(),v("div",{key:((i=o.ongoingResult)==null?void 0:i.anime_id)||`ongoing-${m}`,class:"card",onClick:w=>{var h,$;return a(((h=o.ongoingResult)==null?void 0:h.anime_id)||(($=o.ongoingResult)==null?void 0:$.title))}},[n("img",{src:u(o),alt:((l=o.ongoingResult)==null?void 0:l.title)||"Аниме"},null,8,je),n("div",Je,[n("h3",null,y(((g=o.ongoingResult)==null?void 0:g.title)||"Без названия"),1),n("p",null,y(((A=o.ongoingResult)==null?void 0:A.description)||"Описание отсутствует"),1)])],8,qe)}),128))])):(d(),v("div",Ve,[..._[0]||(_[0]=[n("p",null,"Загрузка онгоингов...",-1)])]))])]),_[2]||(_[2]=n("footer",{class:"footer"},[n("p",null,"© 2025 AnimeZone — made by ./dot")],-1))]))}}),We=pe(Ge,[["__scopeId","data-v-6db85ec9"]]),re={playbackSpeed:1,volume:1,isMuted:!1},oe="player_settings",Y="anime_progress",ae="animeHistory",z="favourites_list",ie="anime_status",V=ce("saveManager",()=>{const r=b({...re}),e=b({}),t=b({}),s=b([]),a=b([]),u=()=>{try{const f=localStorage.getItem(oe);f&&(r.value={...re,...JSON.parse(f)});const P=localStorage.getItem(Y);P&&(e.value=JSON.parse(P));const H=localStorage.getItem(ae);H?s.value=JSON.parse(H)||[]:s.value=[];const W=localStorage.getItem(z);W?a.value=JSON.parse(W)||[]:a.value=[];const X=localStorage.getItem(ie);X&&(t.value=JSON.parse(X))}catch(f){console.error("Error loading saved data:",f)}},c=f=>{r.value={...r.value,...f};try{localStorage.setItem(oe,JSON.stringify(r.value))}catch(P){console.error("Error saving settings:",P)}},p=f=>{c({playbackSpeed:f})},_=f=>{c({volume:f})},o=f=>{c({isMuted:f})},m=(f,P)=>{console.log("Saving anime progress for URL:",f,"Data:",P),e.value[f]=P;try{localStorage.setItem(Y,JSON.stringify(e.value))}catch(H){console.error("Error saving anime progress:",H)}},i=f=>e.value[f]||void 0,l=()=>({...e.value}),g=f=>{delete e.value[f];try{localStorage.setItem(Y,JSON.stringify(e.value))}catch(P){console.error("Error clearing anime progress:",P)}},A=f=>{s.value=s.value.filter(P=>P!==f),s.value.unshift(f),localStorage.setItem(ae,JSON.stringify(s.value))},w=f=>{a.value=a.value.filter(P=>P!==f),a.value.unshift(f),localStorage.setItem(z,JSON.stringify(a.value))},h=f=>{a.value=a.value.filter(P=>P!==f),localStorage.setItem(z,JSON.stringify(a.value))},$=f=>a.value.includes(f),S=(f,P)=>{P===0?delete t.value[f]:t.value[f]=P,localStorage.setItem(ie,JSON.stringify(t.value))},I=f=>t.value[f]||0,k=()=>t.value;return u(),{settings:r,animeProgress:e,animeStatus:t,history:s,favourites:a,saveSettings:c,setPlaybackSpeed:p,setVolume:_,setMuted:o,saveAnimeProgress:m,getAnimeProgress:i,getAllAnimeProgress:l,clearAnimeProgress:g,saveAnimeToHistory:A,addAnimeToFavourites:w,removeAnimeFromFavourites:h,checkIsFavourite:$,setAnimeStatus:S,checkAnimeStatus:I,getFullAnimeStatus:k}}),Ye={class:"loading-spinner"},G=U({__name:"LoadingSpinner",setup(r){return(e,t)=>(d(),v("div",Ye,[...t[0]||(t[0]=[n("div",{class:"spinner"},null,-1)])]))}}),ze={class:"anime-page"},Be={key:0,class:"loading-container"},Ke={key:1,class:"error-container"},Me={class:"error-text"},Ze={key:2,class:"anime-content"},Qe={class:"anime-header"},Xe={class:"anime-poster"},et=["src","alt"],tt={class:"anime-info"},st={class:"anime-title"},nt={class:"anime-meta"},rt={class:"anime-type"},ot={class:"anime-year"},at=["data-status"],it={class:"anime-description"},lt={class:"anime-actions"},ct={class:"anime-episodes"},ut={key:0,class:"no-players"},dt={key:1,class:"players-container"},pt={class:"episodes-list"},ht=["onClick"],vt=U({__name:"AnimePage",props:{url:{}},setup(r){const e=r,t=N(),s=V(),{playAnime:a}=t,{addAnimeToFavourites:u,removeAnimeFromFavourites:c,checkIsFavourite:p,saveAnimeToHistory:_}=s,o=b(null),m=b(!0),i=b(null),l=T(()=>o.value?p(o.value.animeResult.anime_url):!1),g=h=>h.startsWith("http")?h:`https:${h}`,A=()=>{if(!o.value)return;const h=o.value.animeResult.anime_url;l.value?c(h):u(h)},w=h=>{o.value&&(_(o.value.animeResult.anime_url),a(o.value))};return F(async()=>{try{const $=await new j().getAnime(e.url);o.value=$}catch(h){i.value="Ошибка при загрузке аниме",console.error("Error loading anime:",h)}finally{m.value=!1}}),(h,$)=>(d(),v("div",ze,[m.value?(d(),v("div",Be,[D(G)])):i.value?(d(),v("div",Ke,[n("p",Me,y(i.value),1)])):o.value?(d(),v("div",Ze,[n("div",Qe,[n("div",Xe,[n("img",{src:g(o.value.animeResult.poster.huge),alt:o.value.animeResult.title},null,8,et)]),n("div",tt,[n("h1",st,y(o.value.animeResult.title),1),n("div",nt,[n("span",rt,y(o.value.animeResult.type.name),1),n("span",ot,y(o.value.animeResult.year),1),n("span",{class:"anime-status","data-status":o.value.animeResult.anime_status.title},y(o.value.animeResult.anime_status.title),9,at)]),n("p",it,y(o.value.animeResult.description),1),n("div",lt,[n("button",{class:"action-button",onClick:A},[$[0]||($[0]=n("svg",{class:"heart-icon",viewBox:"0 0 24 24",fill:"currentColor"},[n("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})],-1)),ue(" "+y(l.value?"Убрать из избранного":"Добавить в избранное"),1)])])])]),n("div",ct,[$[2]||($[2]=n("h2",null,"Эпизоды",-1)),o.value.players.length===0?(d(),v("div",ut,[...$[1]||($[1]=[n("p",null,"Нет доступных плееров для этого аниме",-1)])])):(d(),v("div",dt,[(d(!0),v(L,null,O(o.value.players,(S,I)=>(d(),v("div",{key:I,class:"player-section"},[n("h3",null,y(S.name),1),(d(!0),v(L,null,O(S.dubbers,(k,f)=>(d(),v("div",{key:f,class:"dubber-section"},[n("h4",null,y(k.dubbing),1),n("div",pt,[(d(!0),v(L,null,O(k.episodes,(P,H)=>(d(),v("button",{key:H,class:"episode-button",onClick:W=>w()},y(P.number),9,ht))),128))])]))),128))]))),128))]))])])):de("",!0)]))}}),mt={class:"search-page"},_t={class:"search-header"},ft={key:0,class:"loading-container"},gt={key:1,class:"error-container"},yt={class:"error-text"},$t={key:2,class:"no-results"},At={key:3,class:"search-results"},bt=["onClick"],Pt={class:"result-poster"},Rt=["src","alt"],wt={class:"result-info"},St={class:"result-title"},kt={class:"result-meta"},Et={class:"result-type"},Ut={class:"result-year"},Ct=["data-status"],xt={class:"result-description"},Lt=U({__name:"AnimeSearchPage",props:{query:{}},setup(r){const e=r,t=N(),{openAnimePage:s}=t,a=b([]),u=b(!0),c=b(null),p=o=>o.startsWith("http")?o:`https:${o}`,_=o=>{s(o.searchResult.anime_url)};return F(async()=>{try{const m=await new j().Search(e.query);a.value=m}catch(o){c.value="Ошибка при поиске",console.error(o)}finally{u.value=!1}}),(o,m)=>(d(),v("div",mt,[n("div",_t,[n("h2",null,'Результаты поиска: "'+y(r.query)+'"',1)]),u.value?(d(),v("div",ft,[D(G)])):c.value?(d(),v("div",gt,[n("p",yt,y(c.value),1)])):a.value.length===0?(d(),v("div",$t,[n("p",null,'Ничего не найдено по запросу "'+y(r.query)+'"',1)])):(d(),v("div",At,[(d(!0),v(L,null,O(a.value,(i,l)=>(d(),v("div",{key:l,class:"search-result-item",onClick:g=>_(i)},[n("div",Pt,[n("img",{src:p(i.searchResult.poster.huge),alt:i.searchResult.title},null,8,Rt)]),n("div",wt,[n("h3",St,y(i.searchResult.title),1),n("div",kt,[n("span",Et,y(i.searchResult.type.name),1),n("span",Ut,y(i.searchResult.year),1),n("span",{class:"result-status","data-status":i.searchResult.anime_status.title},y(i.searchResult.anime_status.title),9,Ct)]),n("p",xt,y(i.searchResult.description),1)])],8,bt))),128))]))]))}}),Ot={class:"iframe-player"},It={class:"player-header"},Nt={class:"episode-selector"},Ft={class:"episode-buttons"},Ht=["onClick"],Tt={key:0,class:"episode-list"},Dt=["onClick"],qt={key:0,class:"video-container"},jt=["src"],Jt={key:1,class:"no-video"},Vt={key:2,class:"no-video"},Gt=U({__name:"IframePlayer",props:{anime:{}},setup(r){const e=r,t=N(),s=V(),{closeLast:a}=t,{saveAnimeProgress:u,getAnimeProgress:c}=s,p=b(0),_=b(0),o=b(""),m=T(()=>e.anime.players&&e.anime.players.length>0?e.anime.players[0]:null),i=T(()=>{var h,$;return(($=(h=m.value)==null?void 0:h.dubbers)==null?void 0:$[p.value])||null}),l=h=>{p.value=h,_.value=0},g=h=>h.number?h.number:h.video&&h.video.number?h.video.number:h.data&&h.data.number?h.data.number:"Episode",A=async h=>{try{console.log("Loading episode:",h),console.log("Episode structure:",Object.keys(h));let $=null,S=null;h.iframe_url?($=h.iframe_url,S=h.number):h.video&&h.video.iframe_url?($=h.video.iframe_url,S=h.video.number):h.data&&h.data.iframe_url&&($=h.data.iframe_url,S=h.data.number),console.log("Episode number:",S),console.log("Iframe URL:",$),$?(o.value=$,u(e.anime.animeResult.anime_url,{player:0,dubber:p.value,episode:_.value,time:0})):console.error("No iframe URL available for episode")}catch($){console.error("Ошибка при загрузке эпизода:",$)}},w=()=>{a()};return F(async()=>{console.log("IframePlayer mounted with anime:",e.anime),console.log("Anime players:",e.anime.players),console.log("Current player:",m.value),console.log("Selected dubber:",i.value);const h=c(e.anime.animeResult.anime_url);h&&(p.value=h.dubber,_.value=h.episode),i.value&&i.value.episodes&&i.value.episodes.length>0&&(console.log("First episode:",i.value.episodes[0]),await A(i.value.episodes[0]))}),(h,$)=>{var S;return d(),v("div",Ot,[n("div",It,[n("h2",null,y(r.anime.animeResult.title),1),n("button",{onClick:w,class:"close-button"},"✕")]),n("div",Nt,[$[0]||($[0]=n("h3",null,"Выберите эпизод:",-1)),n("div",Ft,[(d(!0),v(L,null,O(((S=m.value)==null?void 0:S.dubbers)||[],(I,k)=>(d(),v("button",{key:k,onClick:f=>l(k),class:ee([{active:p.value===k},"dubber-button"])},y(I.dubbing),11,Ht))),128))]),i.value?(d(),v("div",Tt,[(d(!0),v(L,null,O(i.value.episodes,(I,k)=>(d(),v("button",{key:k,onClick:f=>A(I),class:ee([{active:_.value===k},"episode-button"])},y(g(I)),11,Dt))),128))])):de("",!0)]),o.value?(d(),v("div",qt,[n("iframe",{src:o.value,frameborder:"0",allowfullscreen:"",class:"video-iframe"},null,8,jt)])):m.value?(d(),v("div",Vt,[...$[2]||($[2]=[n("p",null,"Выберите эпизод для просмотра",-1)])])):(d(),v("div",Jt,[...$[1]||($[1]=[n("p",null,"Нет доступных плееров для этого аниме",-1)])]))])}}}),Wt={class:"history-page"},Yt={key:0,class:"loading-container"},zt={key:1,class:"error-container"},Bt={class:"error-text"},Kt={key:2,class:"no-history"},Mt={key:3,class:"history-list"},Zt=["onClick"],Qt={class:"history-poster"},Xt=["src","alt"],es={class:"history-info"},ts={class:"history-title"},ss={class:"history-meta"},ns={class:"history-type"},rs={class:"history-year"},os={class:"history-description"},as=U({__name:"HistoryPage",setup(r){const e=N(),t=V(),{openAnimePage:s}=e,{history:a}=t,u=b([]),c=b(!0),p=b(null),_=m=>m.startsWith("http")?m:`https:${m}`,o=m=>{s(m.animeResult.anime_url)};return F(async()=>{try{const m=new j,i=a.map(g=>m.getAnime(g)),l=await Promise.all(i);u.value=l}catch(m){p.value="Ошибка при загрузке истории",console.error(m)}finally{c.value=!1}}),(m,i)=>(d(),v("div",Wt,[i[1]||(i[1]=n("div",{class:"page-header"},[n("h2",null,"История просмотров")],-1)),c.value?(d(),v("div",Yt,[D(G)])):p.value?(d(),v("div",zt,[n("p",Bt,y(p.value),1)])):u.value.length===0?(d(),v("div",Kt,[...i[0]||(i[0]=[n("p",null,"История просмотров пуста",-1)])])):(d(),v("div",Mt,[(d(!0),v(L,null,O(u.value,(l,g)=>(d(),v("div",{key:g,class:"history-item",onClick:A=>o(l)},[n("div",Qt,[n("img",{src:_(l.animeResult.poster.huge),alt:l.animeResult.title},null,8,Xt)]),n("div",es,[n("h3",ts,y(l.animeResult.title),1),n("div",ss,[n("span",ns,y(l.animeResult.type.name),1),n("span",rs,y(l.animeResult.year),1)]),n("p",os,y(l.animeResult.description),1)])],8,Zt))),128))]))]))}}),is={class:"favourites-page"},ls={key:0,class:"loading-container"},cs={key:1,class:"error-container"},us={class:"error-text"},ds={key:2,class:"no-favourites"},ps={key:3,class:"favourites-list"},hs=["onClick"],vs={class:"favourite-poster"},ms=["src","alt"],_s={class:"favourite-info"},fs={class:"favourite-title"},gs={class:"favourite-meta"},ys={class:"favourite-type"},$s={class:"favourite-year"},As={class:"favourite-description"},bs=["onClick"],Ps=U({__name:"FavouritesPage",setup(r){const e=N(),t=V(),{openAnimePage:s}=e,{favourites:a,removeAnimeFromFavourites:u}=t,c=b([]),p=b(!0),_=b(null),o=l=>l.startsWith("http")?l:`https:${l}`,m=l=>{s(l.animeResult.anime_url)},i=l=>{u(l.animeResult.anime_url),c.value=c.value.filter(g=>g.animeResult.anime_url!==l.animeResult.anime_url)};return F(async()=>{try{const l=new j,g=a.map(w=>l.getAnime(w)),A=await Promise.all(g);c.value=A}catch(l){_.value="Ошибка при загрузке избранного",console.error(l)}finally{p.value=!1}}),(l,g)=>(d(),v("div",is,[g[2]||(g[2]=n("div",{class:"page-header"},[n("h2",null,"Избранное")],-1)),p.value?(d(),v("div",ls,[D(G)])):_.value?(d(),v("div",cs,[n("p",us,y(_.value),1)])):c.value.length===0?(d(),v("div",ds,[...g[0]||(g[0]=[n("p",null,"Список избранного пуст",-1)])])):(d(),v("div",ps,[(d(!0),v(L,null,O(c.value,(A,w)=>(d(),v("div",{key:w,class:"favourite-item",onClick:h=>m(A)},[n("div",vs,[n("img",{src:o(A.animeResult.poster.huge),alt:A.animeResult.title},null,8,ms)]),n("div",_s,[n("h3",fs,y(A.animeResult.title),1),n("div",gs,[n("span",ys,y(A.animeResult.type.name),1),n("span",$s,y(A.animeResult.year),1)]),n("p",As,y(A.animeResult.description),1)]),n("button",{class:"remove-favourite",onClick:J(h=>i(A),["stop"])},[...g[1]||(g[1]=[n("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[n("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])],8,bs)],8,hs))),128))]))]))}}),Rs={key:0,class:"body-content"},ws=U({__name:"GetBody",setup(r){const e=N(),{currentBody:t}=ge(e),{closeLast:s}=e,a=T(()=>{if(!t.value)return null;switch(t.value.type){case C.Player:return Gt;case C.Search:return Lt;case C.Anime:return vt;case C.History:return as;case C.Favourites:return Ps;default:return null}}),u=T(()=>{if(!t.value)return{};switch(t.value.type){case C.Player:return{anime:t.value.value};case C.Search:return{query:t.value.value};case C.Anime:return{url:t.value.value};default:return{}}}),c=p=>{p.key==="Escape"&&s()};return F(()=>{window.addEventListener("keydown",c,!0),window.scrollTo(0,0)}),ye(()=>{window.removeEventListener("keydown",c,!0)}),(p,_)=>(d(),v("div",null,[D(Ne),q(t)?(d(),v("div",Rs,[(d(),te(be(a.value),$e(Ae(u.value)),null,16))])):(d(),te(We,{key:1}))]))}}),Ss={id:"app"},ks=U({__name:"App",setup(r){return(e,t)=>(d(),v("div",Ss,[D(ws)]))}}),Es="modulepreload",Us=function(r){return"/anime-watchlist/"+r},le={},Cs=function(e,t,s){let a=Promise.resolve();if(t&&t.length>0){let c=function(o){return Promise.all(o.map(m=>Promise.resolve(m).then(i=>({status:"fulfilled",value:i}),i=>({status:"rejected",reason:i}))))};document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),_=(p==null?void 0:p.nonce)||(p==null?void 0:p.getAttribute("nonce"));a=c(t.map(o=>{if(o=Us(o),o in le)return;le[o]=!0;const m=o.endsWith(".css"),i=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${i}`))return;const l=document.createElement("link");if(l.rel=m?"stylesheet":Es,m||(l.as="script"),l.crossOrigin="",l.href=o,_&&l.setAttribute("nonce",_),document.head.appendChild(l),m)return new Promise((g,A)=>{l.addEventListener("load",g),l.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${o}`)))})}))}function u(c){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=c,window.dispatchEvent(p),!p.defaultPrevented)throw c}return a.then(c=>{for(const p of c||[])p.status==="rejected"&&u(p.reason);return e().catch(u)})},xs=Pe({history:Re("/anime-watchlist/"),routes:[{path:"/",name:"home",component:()=>Cs(()=>import("./GetBody-B8HXsZU1.js"),__vite__mapDeps([0,1]))}]}),Q=we(ks);Q.use(Se());Q.use(xs);Q.mount("#app");export{ws as _};
